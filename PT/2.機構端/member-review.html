<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>綁定審核 - 機構端管理系統</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 自訂樣式 -->
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <div class="admin-layout">
        <!-- 側邊欄 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div>
                    <div class="sidebar-title">智慧照護平台</div>
                    <div class="sidebar-subtitle">機構端管理系統</div>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">主要功能</div>
                    
                    <a href="index.html" class="menu-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>儀表板</span>
                    </a>
                    
                    <div class="menu-item expanded" data-submenu="member-submenu">
                        <i class="fas fa-users"></i>
                        <span>個案會員管理</span>
                        <i class="fas fa-chevron-right arrow"></i>
                    </div>
                    <div class="submenu show" id="member-submenu">
                        <a href="members.html" class="menu-item">
                            <span>個案列表</span>
                        </a>
                        <a href="member-binding.html" class="menu-item">
                            <span>綁定設定</span>
                        </a>
                        <a href="member-review.html" class="menu-item active">
                            <span>綁定審核</span>
                        </a>
                    </div>
                    
                    <a href="orders.html" class="menu-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span>訂購清單查詢</span>
                    </a>
                    
                    <a href="revenue.html" class="menu-item">
                        <i class="fas fa-chart-line"></i>
                        <span>分潤報表</span>
                    </a>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">機構功能</div>
                    
                    <a href="organization.html" class="menu-item">
                        <i class="fas fa-building"></i>
                        <span>機構資訊管理</span>
                    </a>
                    
                    <a href="admins.html" class="menu-item">
                        <i class="fas fa-user-shield"></i>
                        <span>管理者權限管理</span>
                    </a>
                    
                    <a href="announcements.html" class="menu-item">
                        <i class="fas fa-bullhorn"></i>
                        <span>機構公告管理</span>
                    </a>
                    
                    <a href="chat.html" class="menu-item">
                        <i class="fas fa-comments"></i>
                        <span>個案關懷通訊</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- 主要內容區 -->
        <div class="main-content">
            <!-- 頂部導覽列 -->
            <header class="top-navbar">
                <div class="navbar-left">
                    <i class="fas fa-bars menu-toggle"></i>
                    <div class="breadcrumb">
                        <a href="index.html">首頁</a>
                        <i class="fas fa-chevron-right"></i>
                        <span>個案會員管理</span>
                        <i class="fas fa-chevron-right"></i>
                        <span>綁定審核</span>
                    </div>
                </div>
                
                <div class="navbar-right">
                    <div class="user-dropdown">
                        <div class="user-avatar">陳</div>
                        <div class="user-info">
                            <div class="user-name">陳小華</div>
                            <div class="user-role">機構管理員</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 頁面內容 -->
            <div class="page-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">綁定審核</h1>
                        <p class="page-subtitle">審核個案的綁定申請，確認後個案即可享有機構服務</p>
                    </div>
                    <div>
                        <button class="btn btn-outline" onclick="refreshList()">
                            <i class="fas fa-sync"></i> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 篩選工具列 -->
                <div class="card">
                    <div class="card-body">
                        <div class="filter-toolbar">
                            <div class="filter-left">
                                <div class="search-box" style="width: 300px;">
                                    <i class="fas fa-search"></i>
                                    <input type="text" placeholder="搜尋申請者姓名或手機號碼...">
                                </div>
                                <select class="form-control" style="width: 150px;" id="statusFilter">
                                    <option value="pending" selected>待審核</option>
                                    <option value="approved">已通過</option>
                                    <option value="rejected">已拒絕</option>
                                    <option value="all">全部</option>
                                </select>
                                <input type="date" class="form-control" style="width: 150px;">
                                <span>至</span>
                                <input type="date" class="form-control" style="width: 150px;">
                            </div>
                            <div class="filter-right">
                                <button class="btn btn-success" onclick="batchApprove()">
                                    <i class="fas fa-check-double"></i> 批次通過
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 待審核申請列表 -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-clipboard-list"></i> 待審核申請
                        </h3>
                        <span class="card-badge orange">3 筆待處理</span>
                    </div>
                    <div class="card-body">
                        <!-- 審核卡片 1 -->
                        <div class="review-card">
                            <div class="review-checkbox">
                                <input type="checkbox" class="select-item">
                            </div>
                            <div class="review-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="review-info">
                                <div class="review-header">
                                    <div class="applicant-name">陳美玲</div>
                                    <div class="apply-time">
                                        <i class="fas fa-clock"></i> 申請時間：2024/01/28 09:30
                                    </div>
                                </div>
                                <div class="review-details">
                                    <div class="detail-row">
                                        <span class="detail-label">手機號碼：</span>
                                        <span class="detail-value">0912-345-678</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">電子郵件：</span>
                                        <span class="detail-value">chen.meiling@example.com</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">綁定方式：</span>
                                        <span class="detail-value">
                                            <span class="method-badge qrcode">
                                                <i class="fas fa-qrcode"></i> QR Code 掃描
                                            </span>
                                        </span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">備註說明：</span>
                                        <span class="detail-value">家屬轉介，需要居家照護服務</span>
                                    </div>
                                </div>
                            </div>
                            <div class="review-actions">
                                <button class="btn btn-success" onclick="approveBinding('REQ001')">
                                    <i class="fas fa-check"></i> 通過
                                </button>
                                <button class="btn btn-danger" onclick="openRejectModal('REQ001')">
                                    <i class="fas fa-times"></i> 拒絕
                                </button>
                                <button class="btn btn-outline" onclick="viewApplicantDetail('REQ001')">
                                    <i class="fas fa-eye"></i> 詳情
                                </button>
                            </div>
                        </div>

                        <!-- 審核卡片 2 -->
                        <div class="review-card">
                            <div class="review-checkbox">
                                <input type="checkbox" class="select-item">
                            </div>
                            <div class="review-avatar" style="background: linear-gradient(145deg, #e74c3c, #c0392b);">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="review-info">
                                <div class="review-header">
                                    <div class="applicant-name">林志明</div>
                                    <div class="apply-time">
                                        <i class="fas fa-clock"></i> 申請時間：2024/01/27 16:45
                                    </div>
                                </div>
                                <div class="review-details">
                                    <div class="detail-row">
                                        <span class="detail-label">手機號碼：</span>
                                        <span class="detail-value">0923-456-789</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">電子郵件：</span>
                                        <span class="detail-value">lin.zhiming@example.com</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">綁定方式：</span>
                                        <span class="detail-value">
                                            <span class="method-badge code">
                                                <i class="fas fa-keyboard"></i> 綁定碼
                                            </span>
                                        </span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">備註說明：</span>
                                        <span class="detail-value">無</span>
                                    </div>
                                </div>
                            </div>
                            <div class="review-actions">
                                <button class="btn btn-success" onclick="approveBinding('REQ002')">
                                    <i class="fas fa-check"></i> 通過
                                </button>
                                <button class="btn btn-danger" onclick="openRejectModal('REQ002')">
                                    <i class="fas fa-times"></i> 拒絕
                                </button>
                                <button class="btn btn-outline" onclick="viewApplicantDetail('REQ002')">
                                    <i class="fas fa-eye"></i> 詳情
                                </button>
                            </div>
                        </div>

                        <!-- 審核卡片 3 -->
                        <div class="review-card">
                            <div class="review-checkbox">
                                <input type="checkbox" class="select-item">
                            </div>
                            <div class="review-avatar" style="background: linear-gradient(145deg, #9b59b6, #8e44ad);">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="review-info">
                                <div class="review-header">
                                    <div class="applicant-name">張小玲</div>
                                    <div class="apply-time">
                                        <i class="fas fa-clock"></i> 申請時間：2024/01/27 10:20
                                    </div>
                                </div>
                                <div class="review-details">
                                    <div class="detail-row">
                                        <span class="detail-label">手機號碼：</span>
                                        <span class="detail-value">0934-567-890</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">電子郵件：</span>
                                        <span class="detail-value">zhang.xiaoling@example.com</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">綁定方式：</span>
                                        <span class="detail-value">
                                            <span class="method-badge search">
                                                <i class="fas fa-search"></i> 搜尋申請
                                            </span>
                                        </span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">備註說明：</span>
                                        <span class="detail-value">鄰居推薦，希望了解日間照護服務</span>
                                    </div>
                                </div>
                            </div>
                            <div class="review-actions">
                                <button class="btn btn-success" onclick="approveBinding('REQ003')">
                                    <i class="fas fa-check"></i> 通過
                                </button>
                                <button class="btn btn-danger" onclick="openRejectModal('REQ003')">
                                    <i class="fas fa-times"></i> 拒絕
                                </button>
                                <button class="btn btn-outline" onclick="viewApplicantDetail('REQ003')">
                                    <i class="fas fa-eye"></i> 詳情
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 最近審核紀錄 -->
                <div class="card" style="margin-top: 25px;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-history"></i> 最近審核紀錄
                        </h3>
                        <a href="review-history.html" class="card-link">查看全部 <i class="fas fa-chevron-right"></i></a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>申請者</th>
                                        <th>申請時間</th>
                                        <th>審核時間</th>
                                        <th>審核結果</th>
                                        <th>審核人員</th>
                                        <th>備註</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div class="avatar">王</div>
                                                <span>王大明</span>
                                            </div>
                                        </td>
                                        <td>2024/01/26 14:30</td>
                                        <td>2024/01/26 15:45</td>
                                        <td><span class="status-badge active">已通過</span></td>
                                        <td>陳小華</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div class="avatar" style="background: #e74c3c;">李</div>
                                                <span>李小華</span>
                                            </div>
                                        </td>
                                        <td>2024/01/26 11:20</td>
                                        <td>2024/01/26 14:00</td>
                                        <td><span class="status-badge active">已通過</span></td>
                                        <td>陳小華</td>
                                        <td>指派給林小美</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div class="avatar" style="background: #95a5a6;">黃</div>
                                                <span>黃志強</span>
                                            </div>
                                        </td>
                                        <td>2024/01/25 09:15</td>
                                        <td>2024/01/25 10:30</td>
                                        <td><span class="status-badge inactive">已拒絕</span></td>
                                        <td>陳小華</td>
                                        <td>資料不完整</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div class="avatar" style="background: #27ae60;">周</div>
                                                <span>周美玲</span>
                                            </div>
                                        </td>
                                        <td>2024/01/24 16:40</td>
                                        <td>2024/01/24 17:30</td>
                                        <td><span class="status-badge active">已通過</span></td>
                                        <td>林小美</td>
                                        <td>-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 拒絕原因 Modal -->
    <div id="rejectModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="width: 500px;">
            <div class="modal-header">
                <h3>拒絕綁定申請</h3>
                <i class="fas fa-times" onclick="closeModal('rejectModal')"></i>
            </div>
            <div class="modal-body">
                <div class="reject-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>拒絕後，申請者將收到通知，且需重新提交申請</span>
                </div>
                <div class="form-group">
                    <label>拒絕原因 *</label>
                    <select class="form-control" id="rejectReason">
                        <option value="">請選擇拒絕原因</option>
                        <option value="incomplete">資料不完整</option>
                        <option value="invalid">資料有誤</option>
                        <option value="duplicate">重複申請</option>
                        <option value="notqualified">不符合資格</option>
                        <option value="other">其他原因</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>補充說明（選填）</label>
                    <textarea class="form-control" rows="3" placeholder="請輸入補充說明，將會顯示給申請者..."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('rejectModal')">取消</button>
                    <button class="btn btn-danger" onclick="confirmReject()">
                        <i class="fas fa-times"></i> 確認拒絕
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通過確認 Modal（指派關懷者）-->
    <div id="approveModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="width: 500px;">
            <div class="modal-header">
                <h3>審核通過設定</h3>
                <i class="fas fa-times" onclick="closeModal('approveModal')"></i>
            </div>
            <div class="modal-body">
                <div class="approve-applicant-info">
                    <div class="avatar large">陳</div>
                    <div class="info">
                        <div class="name">陳美玲</div>
                        <div class="phone">0912-345-678</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>指派關懷者 *</label>
                    <select class="form-control" id="assignCaregiver">
                        <option value="">請選擇關懷者</option>
                        <option value="1">陳小華</option>
                        <option value="2">林小美</option>
                        <option value="3">王大明</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>個案編號（自動產生）</label>
                    <input type="text" class="form-control" value="PT2024001240" readonly>
                </div>
                <div class="form-group">
                    <label>備註（選填）</label>
                    <textarea class="form-control" rows="2" placeholder="內部備註..."></textarea>
                </div>
                <div class="form-group">
                    <label class="checkbox-item">
                        <input type="checkbox" checked> 發送歡迎通知給個案
                    </label>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('approveModal')">取消</button>
                    <button class="btn btn-success" onclick="confirmApprove()">
                        <i class="fas fa-check"></i> 確認通過
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/admin.js"></script>
    <script>
        let currentReviewId = null;

        function refreshList() {
            location.reload();
        }

        function approveBinding(reqId) {
            currentReviewId = reqId;
            document.getElementById('approveModal').style.display = 'flex';
        }

        function openRejectModal(reqId) {
            currentReviewId = reqId;
            document.getElementById('rejectModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function confirmApprove() {
            const caregiver = document.getElementById('assignCaregiver').value;
            if (!caregiver) {
                alert('請選擇關懷者');
                return;
            }
            alert('已通過綁定申請，並指派關懷者');
            closeModal('approveModal');
            // 實際應用中這裡會重新載入列表
        }

        function confirmReject() {
            const reason = document.getElementById('rejectReason').value;
            if (!reason) {
                alert('請選擇拒絕原因');
                return;
            }
            alert('已拒絕綁定申請');
            closeModal('rejectModal');
            // 實際應用中這裡會重新載入列表
        }

        function viewApplicantDetail(reqId) {
            alert('查看申請者詳細資料：' + reqId);
        }

        function batchApprove() {
            const selected = document.querySelectorAll('.select-item:checked');
            if (selected.length === 0) {
                alert('請先勾選要批次通過的申請');
                return;
            }
            if (confirm('確定要批次通過 ' + selected.length + ' 筆申請嗎？')) {
                alert('已批次通過 ' + selected.length + ' 筆申請');
            }
        }

        // 全選功能
        document.querySelector('.select-all')?.addEventListener('change', function() {
            document.querySelectorAll('.select-item').forEach(item => {
                item.checked = this.checked;
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>智慧照護平台 - 保健食品詳情</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 自訂樣式 -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ─── 頂部漸層 Header ─── */
        .supplement-header {
            position: relative;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .supplement-header i {
            font-size: 80px;
            opacity: 0.9;
        }

        .back-btn {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 36px;
            height: 36px;
            min-width: 36px;
            min-height: 36px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: none;
        }

        .back-btn i {
            font-size: 14px !important;
        }

        /* 匹配度標籤 */
        .match-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            color: #fff;
            font-size: 13px;
            font-weight: 700;
        }

        /* ─── 商品資訊卡 ─── */
        .product-info-card {
            margin: -24px 16px 0;
            padding: 20px;
            background: var(--card-background);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            position: relative;
            z-index: 2;
        }

        .product-category {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            background: rgba(45, 106, 79, 0.08);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .product-name {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .product-desc {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ─── 成分 & 功效 ─── */
        .info-section {
            margin: 16px;
            padding: 20px;
            background: var(--card-background);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .info-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 14px;
        }

        .info-section-title i {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 13px;
        }

        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .info-list li:not(:last-child) {
            border-bottom: 1px solid var(--divider-color);
        }

        .info-list li i {
            color: var(--primary-color);
            margin-top: 3px;
            font-size: 13px;
            flex-shrink: 0;
        }

        /* ─── 購買方案切換 ─── */
        .plan-section {
            margin: 16px;
        }

        .plan-section-title {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-section-title i {
            color: var(--accent-color);
        }

        /* 方案 Tab 切換 */
        .plan-tabs {
            display: flex;
            gap: 0;
            background: var(--background-color);
            border-radius: var(--radius-md);
            padding: 4px;
            margin-bottom: 16px;
        }

        .plan-tab {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.25s ease;
            text-align: center;
        }

        .plan-tab.active {
            background: var(--card-background);
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        /* 一次性購買面板 */
        .plan-panel {
            display: none;
        }

        .plan-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .single-purchase-card {
            background: var(--card-background);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: 20px;
        }

        .single-price-row {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .single-price {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--primary-color);
        }

        .single-price-unit {
            font-size: var(--font-size-sm);
            color: var(--text-light);
            font-weight: 400;
        }

        /* 數量選擇器 */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0;
            margin-bottom: 16px;
        }

        .quantity-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            font-weight: 600;
            margin-right: auto;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-color);
            background: var(--card-background);
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .qty-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .qty-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .qty-value {
            width: 50px;
            text-align: center;
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-primary);
        }

        .subtotal-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 14px;
            border-top: 1px solid var(--divider-color);
        }

        .subtotal-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .subtotal-value {
            font-size: var(--font-size-lg);
            font-weight: 800;
            color: var(--primary-color);
        }

        /* 訂閱方案面板 */
        .subscription-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sub-card {
            background: var(--card-background);
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-color);
            padding: 16px;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

        .sub-card:hover {
            border-color: var(--primary-light);
        }

        .sub-card.selected {
            border-color: var(--primary-color);
            background: rgba(45, 106, 79, 0.03);
            box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.1);
        }

        /* 推薦 badge */
        .sub-badge {
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 700;
            color: #fff;
            border-radius: 0 0 0 12px;
        }

        .sub-badge.best-value {
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
        }

        .sub-badge.popular {
            background: linear-gradient(145deg, var(--accent-color), var(--accent-dark));
        }

        .sub-card-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .sub-cycle {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--text-primary);
        }

        .sub-discount {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-color);
            background: rgba(45, 106, 79, 0.08);
            padding: 3px 10px;
            border-radius: 12px;
        }

        .sub-card-bottom {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .sub-price {
            font-size: var(--font-size-lg);
            font-weight: 800;
            color: var(--primary-color);
        }

        .sub-original-price {
            font-size: 14px;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .sub-per-month {
            font-size: 12px;
            color: var(--text-light);
            margin-left: auto;
        }

        /* 訂閱福利 */
        .sub-benefits {
            margin: 16px 0 0;
            padding: 16px;
            background: var(--background-color);
            border-radius: var(--radius-md);
        }

        .sub-benefits-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sub-benefits-title i {
            color: var(--accent-color);
        }

        .sub-benefits ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sub-benefits li {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .sub-benefits li i {
            color: var(--primary-color);
            font-size: 12px;
        }

        /* 選取標記 */
        .sub-check {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: transparent;
            transition: all 0.2s ease;
        }

        .sub-card.selected .sub-check {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
        }

        /* ─── 底部固定操作列 ─── */
        .bottom-purchase-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--card-background);
            border-top: 1px solid var(--divider-color);
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            box-sizing: border-box;
        }

        .bar-price-info {
            flex: 1;
        }

        .bar-price-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .bar-price-value {
            font-size: var(--font-size-lg);
            font-weight: 800;
            color: var(--primary-color);
        }

        .btn-purchase {
            padding: 14px 28px;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 700;
            cursor: pointer;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
            white-space: nowrap;
        }

        .btn-purchase:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(45, 106, 79, 0.4);
        }

        .main-content {
            padding-bottom: 100px;
        }
    </style>
</head>
<body>
    <!-- 手機容器 -->
    <div class="mobile-container">
        <!-- 主要內容區（header 在漸層中） -->
        <main class="main-content">
            <!-- 頂部漸層 -->
            <div class="supplement-header" id="productHeader">
                <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="match-badge" id="matchBadge" style="display: none;">
                    <i class="fas fa-star"></i>
                    <span id="matchPercent"></span>
                </div>
                <i class="fas fa-capsules" id="productIcon"></i>
            </div>

            <!-- 商品資訊卡 -->
            <div class="product-info-card">
                <div class="product-category" id="productCategory">
                    <i class="fas fa-capsules"></i> 保健食品
                </div>
                <div class="product-name" id="productName">載入中...</div>
                <div class="product-desc" id="productDesc"></div>
            </div>

            <!-- 主要成分 -->
            <div class="info-section">
                <div class="info-section-title">
                    <i class="fas fa-flask"></i>
                    <span>主要成分</span>
                </div>
                <ul class="info-list" id="ingredientsList">
                    <!-- 由 JS 動態生成 -->
                </ul>
            </div>

            <!-- 產品功效 -->
            <div class="info-section">
                <div class="info-section-title">
                    <i class="fas fa-check-double"></i>
                    <span>產品功效</span>
                </div>
                <ul class="info-list" id="benefitsList">
                    <!-- 由 JS 動態生成 -->
                </ul>
            </div>

            <!-- ===== 購買方案 ===== -->
            <div class="plan-section">
                <div class="plan-section-title">
                    <i class="fas fa-shopping-bag"></i>
                    <span>選擇購買方案</span>
                </div>

                <!-- Tab 切換 -->
                <div class="plan-tabs">
                    <button class="plan-tab active" data-plan="single" onclick="switchPlan('single')">
                        <i class="fas fa-box"></i> 一次性購買
                    </button>
                    <button class="plan-tab" data-plan="subscription" onclick="switchPlan('subscription')">
                        <i class="fas fa-sync-alt"></i> 訂閱方案
                    </button>
                </div>

                <!-- 一次性購買面板 -->
                <div class="plan-panel active" id="panelSingle">
                    <div class="single-purchase-card">
                        <div class="single-price-row">
                            <div>
                                <span class="single-price" id="singlePrice">NT$ 1,200</span>
                                <span class="single-price-unit"> / 盒</span>
                            </div>
                        </div>
                        <div class="quantity-control">
                            <span class="quantity-label">購買數量</span>
                            <button class="qty-btn" id="qtyMinus" onclick="updateQuantity(-1)">−</button>
                            <span class="qty-value" id="qtyValue">1</span>
                            <button class="qty-btn" onclick="updateQuantity(1)">+</button>
                        </div>
                        <div class="subtotal-row">
                            <span class="subtotal-label">小計</span>
                            <span class="subtotal-value" id="subtotalValue">NT$ 1,200</span>
                        </div>
                    </div>
                </div>

                <!-- 訂閱方案面板 -->
                <div class="plan-panel" id="panelSubscription">
                    <div class="subscription-cards" id="subscriptionCards">
                        <!-- 由 JS 動態生成 -->
                    </div>

                    <!-- 訂閱福利 -->
                    <div class="sub-benefits">
                        <div class="sub-benefits-title">
                            <i class="fas fa-gift"></i> 訂閱專屬福利
                        </div>
                        <ul>
                            <li><i class="fas fa-check"></i> 每月自動配送到府，免運費</li>
                            <li><i class="fas fa-check"></i> 隨時可暫停、調整或取消訂閱</li>
                            <li><i class="fas fa-check"></i> 訂閱期間享專屬優惠價</li>
                            <li><i class="fas fa-check"></i> 到期前 7 日自動提醒</li>
                            <li><i class="fas fa-check"></i> 專人客服優先處理</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部購買列 -->
        <div class="bottom-purchase-bar">
            <div class="bar-price-info">
                <div class="bar-price-label" id="barLabel">合計</div>
                <div class="bar-price-value" id="barPrice">NT$ 1,200</div>
            </div>
            <button class="btn-purchase" id="btnPurchase" onclick="proceedToCheckout()">
                <i class="fas fa-shopping-cart"></i> 立即購買
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script>
        /**
         * ─── 保健食品資料庫 ───
         */
        const supplementProducts = {
            25: {
                id: 25, name: '日常保健補給', icon: 'fa-capsules', color: '#3F7C6A', colorDark: '#2E5E50',
                desc: '綜合維生素與礦物質配方，適合日常營養補給，維持身體基本機能運作。含人體每日所需的多種維生素與礦物質，幫助填補營養缺口。',
                tags: ['免疫力提升', '體力增強'],
                ingredients: ['綜合維生素B群', '維生素C 500mg', '維生素D3 2000IU', '鋅 15mg', '硒 55mcg', '葉酸 400mcg'],
                benefits: ['補充日常營養缺口，維持身體機能', '提升免疫系統防護力', '增強體力與精神，減少疲勞感', '促進新陳代謝'],
                allergens: [],
                singlePrice: 1200,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 980, originalPrice: 1200, discount: '省18%', months: 1 },
                    { cycle: '季訂閱', price: 2700, originalPrice: 3600, discount: '省25%', months: 3 },
                    { cycle: '半年訂閱', price: 5000, originalPrice: 7200, discount: '省31%', months: 6 }
                ]
            },
            26: {
                id: 26, name: '關節靈活配方', icon: 'fa-bone', color: '#2B6CB0', colorDark: '#1A4A7C',
                desc: '葡萄糖胺與軟骨素複合配方，保護關節軟骨，改善關節靈活度與舒適度。特別適合關節不適、行動力下降的中高齡族群。',
                tags: ['關節保養', '骨質強化'],
                ingredients: ['葡萄糖胺 1500mg', '軟骨素 1200mg', 'MSM（甲基磺醯甲烷）500mg', '第二型膠原蛋白 40mg', '薑黃素 95%', '玻尿酸 60mg'],
                benefits: ['保護關節軟骨，減緩磨損', '減輕關節腫脹與不適感', '提升行動靈活度', '促進軟骨組織修復'],
                allergens: ['海鮮'],
                singlePrice: 1500,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 1280, originalPrice: 1500, discount: '省15%', months: 1 },
                    { cycle: '季訂閱', price: 3500, originalPrice: 4500, discount: '省22%', months: 3 },
                    { cycle: '半年訂閱', price: 6500, originalPrice: 9000, discount: '省28%', months: 6 }
                ]
            },
            27: {
                id: 27, name: '心血管守護配方', icon: 'fa-heart-pulse', color: '#C53030', colorDark: '#9B2C2C',
                desc: '高濃度魚油 Omega-3 搭配 CoQ10，維護心血管健康，調節血脂與血壓。適合有心血管保健需求的族群。',
                tags: ['心血管保健'],
                ingredients: ['高濃度魚油 Omega-3（EPA+DHA 80%）', '輔酶 CoQ10 100mg', '紅麴 600mg', '納豆激酶 2000FU', '維生素E 400IU'],
                benefits: ['維護心血管健康與彈性', '調節血脂、降低壞膽固醇', '抗氧化保護，延緩老化', '促進血液循環'],
                allergens: ['海鮮'],
                singlePrice: 1800,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 1500, originalPrice: 1800, discount: '省17%', months: 1 },
                    { cycle: '季訂閱', price: 4200, originalPrice: 5400, discount: '省22%', months: 3 },
                    { cycle: '半年訂閱', price: 7800, originalPrice: 10800, discount: '省28%', months: 6 }
                ]
            },
            28: {
                id: 28, name: '益生菌腸道配方', icon: 'fa-bacterium', color: '#D4A574', colorDark: '#B8956C',
                desc: '300 億活菌複合配方，改善腸道菌叢生態，增強消化機能與免疫力。採用專利包埋技術，確保活菌到達腸道。',
                tags: ['消化改善', '免疫力提升'],
                ingredients: ['嗜酸乳桿菌 100億', '雙歧桿菌 100億', '鼠李糖乳桿菌 50億', '副乾酪乳桿菌 50億', '果寡糖 3g', '膳食纖維 2g'],
                benefits: ['改善腸道菌叢平衡', '促進消化吸收能力', '增強腸道免疫屏障', '改善排便順暢度'],
                allergens: ['乳製品'],
                singlePrice: 1100,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 900, originalPrice: 1100, discount: '省18%', months: 1 },
                    { cycle: '季訂閱', price: 2500, originalPrice: 3300, discount: '省24%', months: 3 },
                    { cycle: '半年訂閱', price: 4600, originalPrice: 6600, discount: '省30%', months: 6 }
                ]
            },
            29: {
                id: 29, name: '鈣質骨力配方', icon: 'fa-dumbbell', color: '#6B46C1', colorDark: '#4C2889',
                desc: '海藻鈣搭配維生素 D3 與 K2，強化骨骼密度，預防骨質流失。天然海藻鈣吸收率高，適合中高齡族群。',
                tags: ['骨質強化', '關節保養'],
                ingredients: ['海藻鈣 1000mg', '維生素D3 2000IU', '維生素K2 90mcg', '鎂 400mg', '鋅 15mg', 'CPP（酪蛋白磷酸肽）'],
                benefits: ['強化骨骼密度與硬度', '促進鈣質高效吸收', '延緩骨質疏鬆進程', '維持肌肉正常功能'],
                allergens: [],
                singlePrice: 1300,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 1080, originalPrice: 1300, discount: '省17%', months: 1 },
                    { cycle: '季訂閱', price: 3000, originalPrice: 3900, discount: '省23%', months: 3 },
                    { cycle: '半年訂閱', price: 5600, originalPrice: 7800, discount: '省28%', months: 6 }
                ]
            },
            30: {
                id: 30, name: '葉黃素護眼配方', icon: 'fa-eye', color: '#DD6B20', colorDark: '#C05621',
                desc: '游離型葉黃素搭配玉米黃素與花青素，保護黃斑部，維護視力健康。適合長時間使用 3C 產品或有視力保健需求者。',
                tags: ['視力保健'],
                ingredients: ['游離型葉黃素 30mg', '玉米黃素 6mg', '蝦紅素 6mg', '藍莓萃取物 100mg', '維生素A 5000IU', '花青素 OPC'],
                benefits: ['保護黃斑部健康', '減緩眼睛疲勞與乾澀', '對抗藍光與紫外線傷害', '維護夜間視力'],
                allergens: [],
                singlePrice: 1200,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 990, originalPrice: 1200, discount: '省18%', months: 1 },
                    { cycle: '季訂閱', price: 2750, originalPrice: 3600, discount: '省24%', months: 3 },
                    { cycle: '半年訂閱', price: 5100, originalPrice: 7200, discount: '省29%', months: 6 }
                ]
            },
            31: {
                id: 31, name: '舒眠GABA配方', icon: 'fa-moon', color: '#319795', colorDark: '#256D6D',
                desc: '天然 GABA 搭配色胺酸與芝麻素，幫助放鬆身心，改善睡眠品質。不含安眠藥成分，溫和助眠無依賴性。',
                tags: ['睡眠改善'],
                ingredients: ['GABA（γ-氨基丁酸）500mg', '色胺酸 200mg', '芝麻素 60mg', '甘胺酸 3000mg', '鎂 300mg', '西番蓮萃取物'],
                benefits: ['幫助放鬆入睡', '提升深層睡眠品質', '舒緩壓力與焦慮感', '改善起床後精神狀態'],
                allergens: [],
                singlePrice: 1400,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 1150, originalPrice: 1400, discount: '省18%', months: 1 },
                    { cycle: '季訂閱', price: 3200, originalPrice: 4200, discount: '省24%', months: 3 },
                    { cycle: '半年訂閱', price: 6000, originalPrice: 8400, discount: '省29%', months: 6 }
                ]
            },
            32: {
                id: 32, name: '活力人蔘精華', icon: 'fa-bolt', color: '#C4873B', colorDark: '#A66B2E',
                desc: '高麗蔘精華搭配 B群與鐵質，全面提升體力與精神活力。六年根人蔘精華，高濃度人蔘皂苷，效果顯著。',
                tags: ['體力增強', '免疫力提升'],
                ingredients: ['六年根高麗蔘萃取 500mg', '維生素B群（8種）', '鐵質 18mg', '牛磺酸 1000mg', '左旋肉鹼 500mg', '瑪卡萃取物'],
                benefits: ['增強體力與耐力', '提升精神活力與專注', '改善身體疲勞感', '促進能量代謝'],
                allergens: [],
                singlePrice: 1600,
                subscriptionPlans: [
                    { cycle: '月訂閱', price: 1350, originalPrice: 1600, discount: '省16%', months: 1 },
                    { cycle: '季訂閱', price: 3800, originalPrice: 4800, discount: '省21%', months: 3 },
                    { cycle: '半年訂閱', price: 7000, originalPrice: 9600, discount: '省27%', months: 6 }
                ]
            }
        };

        /**
         * ─── 頁面狀態 ───
         */
        let currentProduct = null;
        let currentPlanType = 'single'; // 'single' or 'subscription'
        let currentQuantity = 1;
        let selectedSubIndex = 0; // 預設選月訂閱

        /**
         * ─── 頁面初始化 ───
         */
        document.addEventListener('DOMContentLoaded', function() {
            loadProductDetail();
        });

        /**
         * 載入商品詳情
         */
        function loadProductDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || '25';
            currentProduct = supplementProducts[productId];

            if (!currentProduct) {
                showToast('找不到此商品', 'error');
                setTimeout(() => goBack(), 1000);
                return;
            }

            // 填充頁面
            document.getElementById('productHeader').style.background =
                `linear-gradient(145deg, ${currentProduct.color}, ${currentProduct.colorDark})`;
            document.getElementById('productIcon').className = `fas ${currentProduct.icon}`;
            document.getElementById('productName').textContent = currentProduct.name;
            document.getElementById('productDesc').textContent = currentProduct.desc;
            document.title = `智慧照護平台 - ${currentProduct.name}`;

            // 顯示匹配度（若有評估結果）
            showMatchBadge(productId);

            // 成分列表
            document.getElementById('ingredientsList').innerHTML = currentProduct.ingredients
                .map(i => `<li><i class="fas fa-flask"></i><span>${i}</span></li>`).join('');

            // 功效列表
            document.getElementById('benefitsList').innerHTML = currentProduct.benefits
                .map(b => `<li><i class="fas fa-check-circle"></i><span>${b}</span></li>`).join('');

            // 過敏警告
            if (currentProduct.allergens.length > 0) {
                const allergenHtml = `
                    <div class="info-section" style="border: 2px solid var(--warning-color); background: #FFFBEB;">
                        <div class="info-section-title" style="color: var(--warning-color);">
                            <i class="fas fa-triangle-exclamation" style="background: linear-gradient(145deg, var(--warning-color), #A66B2E);"></i>
                            <span>過敏提醒</span>
                        </div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin: 0;">
                            此產品含有 <strong style="color: var(--warning-color);">${currentProduct.allergens.join('、')}</strong> 相關成分，若有過敏請謹慎選購。
                        </p>
                    </div>
                `;
                document.querySelector('.plan-section').insertAdjacentHTML('beforebegin', allergenHtml);
            }

            // 一次性價格
            document.getElementById('singlePrice').textContent = `NT$ ${currentProduct.singlePrice.toLocaleString()}`;
            updateSingleSubtotal();

            // 訂閱方案卡片
            renderSubscriptionCards();

            // 更新底部價格
            updateBottomBar();
        }

        /**
         * 顯示匹配度標章
         */
        function showMatchBadge(productId) {
            const resultsRaw = localStorage.getItem('healthAssessmentResult');
            if (!resultsRaw) return;

            const results = JSON.parse(resultsRaw);
            const match = results.find(r => r.id == productId);
            if (match && match.matchPercent) {
                const badge = document.getElementById('matchBadge');
                badge.style.display = 'flex';
                document.getElementById('matchPercent').textContent = `適合度 ${match.matchPercent}%`;
            }
        }

        /**
         * 渲染訂閱方案卡片
         */
        function renderSubscriptionCards() {
            const container = document.getElementById('subscriptionCards');
            const plans = currentProduct.subscriptionPlans;
            const badges = ['', 'popular', 'best-value'];
            const badgeText = ['', '最熱門', '最划算'];

            container.innerHTML = plans.map((plan, idx) => {
                const perMonth = plan.months > 1
                    ? `約 NT$ ${Math.round(plan.price / plan.months).toLocaleString()}/月`
                    : '';
                return `
                    <div class="sub-card ${idx === 0 ? 'selected' : ''}" onclick="selectSubscription(${idx})">
                        <div class="sub-check"><i class="fas fa-check"></i></div>
                        ${badges[idx] ? `<div class="sub-badge ${badges[idx]}">${badgeText[idx]}</div>` : ''}
                        <div class="sub-card-top" style="padding-left: 30px;">
                            <span class="sub-cycle">${plan.cycle}</span>
                            <span class="sub-discount">${plan.discount}</span>
                        </div>
                        <div class="sub-card-bottom" style="padding-left: 30px;">
                            <span class="sub-price">NT$ ${plan.price.toLocaleString()}</span>
                            <span class="sub-original-price">NT$ ${plan.originalPrice.toLocaleString()}</span>
                            ${perMonth ? `<span class="sub-per-month">${perMonth}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * ─── 方案切換 ───
         */
        function switchPlan(type) {
            currentPlanType = type;

            // Tab 狀態
            document.querySelectorAll('.plan-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.plan === type);
            });

            // Panel 顯示
            document.getElementById('panelSingle').classList.toggle('active', type === 'single');
            document.getElementById('panelSubscription').classList.toggle('active', type === 'subscription');

            // 更新底部
            updateBottomBar();
        }

        /**
         * ─── 一次性購買：數量控制 ───
         */
        function updateQuantity(delta) {
            currentQuantity = Math.max(1, Math.min(currentQuantity + delta, 10));
            document.getElementById('qtyValue').textContent = currentQuantity;
            document.getElementById('qtyMinus').disabled = currentQuantity <= 1;
            updateSingleSubtotal();
            updateBottomBar();
        }

        function updateSingleSubtotal() {
            if (!currentProduct) return;
            const subtotal = currentProduct.singlePrice * currentQuantity;
            document.getElementById('subtotalValue').textContent = `NT$ ${subtotal.toLocaleString()}`;
        }

        /**
         * ─── 訂閱方案：選取 ───
         */
        function selectSubscription(index) {
            selectedSubIndex = index;
            document.querySelectorAll('.sub-card').forEach((card, idx) => {
                card.classList.toggle('selected', idx === index);
            });
            updateBottomBar();
        }

        /**
         * ─── 更新底部價格列 ───
         */
        function updateBottomBar() {
            if (!currentProduct) return;

            const labelEl = document.getElementById('barLabel');
            const priceEl = document.getElementById('barPrice');
            const btnEl = document.getElementById('btnPurchase');

            if (currentPlanType === 'single') {
                const total = currentProduct.singlePrice * currentQuantity;
                labelEl.textContent = `合計（${currentQuantity} 盒）`;
                priceEl.textContent = `NT$ ${total.toLocaleString()}`;
                btnEl.innerHTML = '<i class="fas fa-shopping-cart"></i> 立即購買';
            } else {
                const plan = currentProduct.subscriptionPlans[selectedSubIndex];
                labelEl.textContent = plan.cycle;
                priceEl.textContent = `NT$ ${plan.price.toLocaleString()}`;
                btnEl.innerHTML = '<i class="fas fa-sync-alt"></i> 立即訂閱';
            }
        }

        /**
         * ─── 前往結帳 ───
         */
        function proceedToCheckout() {
            if (!currentProduct) return;

            const orderData = {
                productId: currentProduct.id,
                productName: currentProduct.name,
                productIcon: currentProduct.icon,
                productColor: currentProduct.color,
                productColorDark: currentProduct.colorDark,
                planType: currentPlanType,
                timestamp: Date.now()
            };

            if (currentPlanType === 'single') {
                orderData.quantity = currentQuantity;
                orderData.unitPrice = currentProduct.singlePrice;
                orderData.totalPrice = currentProduct.singlePrice * currentQuantity;
            } else {
                const plan = currentProduct.subscriptionPlans[selectedSubIndex];
                orderData.subscriptionCycle = plan.cycle;
                orderData.subscriptionPrice = plan.price;
                orderData.originalPrice = plan.originalPrice;
                orderData.discount = plan.discount;
                orderData.months = plan.months;
                orderData.totalPrice = plan.price;
            }

            localStorage.setItem('supplementOrder', JSON.stringify(orderData));

            showToast('即將前往結帳...', 'success');
            setTimeout(() => {
                navigateTo('supplement-checkout.html');
            }, 600);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>搜尋服務</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 自訂樣式 -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="mobile-container">
        <header class="header">
            <i class="fas fa-arrow-left" onclick="goBack()" style="cursor: pointer;"></i>
            <div class="header-title">搜尋服務</div>
            <div style="font-size:20px;"></div>
        </header>

        <main class="main-content">
            <div class="search-box">
                <div class="search-input">
                    <i class="fas fa-search"></i>
                    <input type="text" id="serviceSearchInput" placeholder="輸入服務名稱或關鍵字...">
                </div>
            </div>

            <section class="service-section">
                <div class="search-filters">
                    <select class="form-control" id="categoryFilter">
                        <option value="all">全部類別</option>
                        <option value="居家照護">居家照護</option>
                        <option value="保健食品">保健食品</option>
                        <option value="健康檢測">健康檢測</option>
                        <option value="用藥提醒">用藥提醒</option>
                        <option value="營養餐食">營養餐食</option>
                        <option value="交通接送">交通接送</option>
                        <option value="陪伴服務">陪伴服務</option>
                        <option value="居家清潔">居家清潔</option>
                        <option value="輔具租借">輔具租借</option>
                    </select>
                    <select class="form-control" id="sortFilter">
                        <option value="default">預設排序</option>
                        <option value="price-asc">價格由低到高</option>
                        <option value="price-desc">價格由高到低</option>
                    </select>
                </div>

                <div class="section-title">
                    <span>搜尋結果</span>
                    <span id="resultCount"style="font-size: 14px; color: var(--text-light);"></span>
                </div>
                <div class="service-list" id="searchResults"></div>
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-search"></i>
                    <p>找不到符合的服務</p>
                </div>
            </section>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        const allServices = [
            { id: 1, name: '專業居家照護服務', desc: '由專業照服員提供貼心的居家照護', price: 'NT$ 1,200/時', originalPrice: 'NT$ 1,500', category: '居家照護', icon: 'fa-user-nurse', color: '#2D6A4F', colorDark: '#1B4332', needBinding: false },
            { id: 2, name: '夜間居家照護', desc: '夜間專人陪伴照護服務', price: 'NT$ 1,800/晚', originalPrice: '', category: '居家照護', icon: 'fa-moon', color: '#2D6A4F', colorDark: '#1B4332', needBinding: false },
            { id: 3, name: '臨時居家照護', desc: '短期臨時照護需求', price: 'NT$ 800/時', originalPrice: '', category: '居家照護', icon: 'fa-clock', color: '#2D6A4F', colorDark: '#1B4332', needBinding: false },
            { id: 25, name: '日常保健補給訂閱', desc: '維持活力的每日營養補給，月訂閱配送', price: 'NT$ 980/月', originalPrice: '', category: '保健食品', icon: 'fa-capsules', color: '#3F7C6A', colorDark: '#2E5E50', needBinding: false },
            { id: 26, name: '關節靈活訂閱組合', desc: '關節保養配方，訂閱制每月到府', price: 'NT$ 1,280/月', originalPrice: 'NT$ 1,480', category: '保健食品', icon: 'fa-leaf', color: '#3F7C6A', colorDark: '#2E5E50', needBinding: false },
            { id: 27, name: '心血管守護訂閱', desc: '日常心血管保健營養配方，月訂閱制', price: 'NT$ 1,500/月', originalPrice: '', category: '保健食品', icon: 'fa-heart-pulse', color: '#3F7C6A', colorDark: '#2E5E50', needBinding: false },
            { id: 4, name: '健康檢測套餐', desc: '血壓、血糖、心電圖完整檢測', price: 'NT$ 2,500/次', originalPrice: '', category: '健康檢測', icon: 'fa-heartbeat', color: '#2B6CB0', colorDark: '#1A4A7C', needBinding: false },
            { id: 5, name: '血壓監測服務', desc: '定期血壓追蹤與記錄', price: 'NT$ 300/次', originalPrice: '', category: '健康檢測', icon: 'fa-stethoscope', color: '#2B6CB0', colorDark: '#1A4A7C', needBinding: false },
            { id: 6, name: '血糖檢測服務', desc: '血糖數值監測與分析', price: 'NT$ 350/次', originalPrice: '', category: '健康檢測', icon: 'fa-tint', color: '#2B6CB0', colorDark: '#1A4A7C', needBinding: false },
            { id: 7, name: '用藥提醒服務', desc: '每日用藥時間提醒與記錄', price: 'NT$ 200/月', originalPrice: '', category: '用藥提醒', icon: 'fa-pills', color: '#C53030', colorDark: '#9B2C2C', needBinding: false },
            { id: 8, name: '藥物管理服務', desc: '藥物分裝與管理服務', price: 'NT$ 500/月', originalPrice: '', category: '用藥提醒', icon: 'fa-prescription-bottle', color: '#C53030', colorDark: '#9B2C2C', needBinding: false },
            { id: 9, name: '營養餐食配送', desc: '專業營養師調配，每日新鮮配送', price: 'NT$ 180/餐', originalPrice: '', category: '營養餐食', icon: 'fa-utensils', color: '#D4A574', colorDark: '#B8956C', needBinding: false },
            { id: 10, name: '糖尿病專用餐', desc: '低糖低鈉營養均衡餐點', price: 'NT$ 220/餐', originalPrice: '', category: '營養餐食', icon: 'fa-leaf', color: '#D4A574', colorDark: '#B8956C', needBinding: false },
            { id: 11, name: '軟質餐食配送', desc: '易咀嚼易消化的軟質餐點', price: 'NT$ 200/餐', originalPrice: '', category: '營養餐食', icon: 'fa-bowl-food', color: '#D4A574', colorDark: '#B8956C', needBinding: false },
            { id: 12, name: '就醫交通接送', desc: '專人專車，安全舒適的接送服務', price: 'NT$ 500/趟', originalPrice: 'NT$ 650', category: '交通接送', icon: 'fa-car', color: '#6B46C1', colorDark: '#4C2889', needBinding: true },
            { id: 13, name: '復健接送服務', desc: '定期復健療程接送', price: 'NT$ 450/趟', originalPrice: '', category: '交通接送', icon: 'fa-hospital', color: '#6B46C1', colorDark: '#4C2889', needBinding: true },
            { id: 14, name: '長照專車接送', desc: '日照中心往返接送', price: 'NT$ 400/趟', originalPrice: '', category: '交通接送', icon: 'fa-van-shuttle', color: '#6B46C1', colorDark: '#4C2889', needBinding: true },
            { id: 15, name: '長者陪伴服務', desc: '聊天、散步、休閒活動陪伴', price: 'NT$ 400/時', originalPrice: '', category: '陪伴服務', icon: 'fa-hand-holding-heart', color: '#C4873B', colorDark: '#A66B2E', needBinding: false },
            { id: 16, name: '就醫陪伴服務', desc: '陪同就醫看診、領藥', price: 'NT$ 500/次', originalPrice: '', category: '陪伴服務', icon: 'fa-user-doctor', color: '#C4873B', colorDark: '#A66B2E', needBinding: false },
            { id: 17, name: '外出活動陪伴', desc: '陪同購物、運動、社交活動', price: 'NT$ 450/時', originalPrice: '', category: '陪伴服務', icon: 'fa-walking', color: '#C4873B', colorDark: '#A66B2E', needBinding: false },
            { id: 18, name: '居家環境清潔', desc: '專業清潔人員到府服務', price: 'NT$ 1,500/次', originalPrice: '', category: '居家清潔', icon: 'fa-broom', color: '#319795', colorDark: '#256D6D', needBinding: false },
            { id: 19, name: '深度清潔服務', desc: '廚房、浴室深度清潔', price: 'NT$ 2,500/次', originalPrice: '', category: '居家清潔', icon: 'fa-spray-can-sparkles', color: '#319795', colorDark: '#256D6D', needBinding: false },
            { id: 20, name: '定期清潔方案', desc: '每週固定清潔服務', price: 'NT$ 5,000/月', originalPrice: 'NT$ 6,000', category: '居家清潔', icon: 'fa-calendar-check', color: '#319795', colorDark: '#256D6D', needBinding: false },
            { id: 21, name: '輪椅租借', desc: '各式輪椅短期租借服務', price: 'NT$ 500/週', originalPrice: '', category: '輔具租借', icon: 'fa-wheelchair', color: '#DD6B20', colorDark: '#C05621', needBinding: false },
            { id: 22, name: '電動床租借', desc: '居家照護電動床租借', price: 'NT$ 2,000/月', originalPrice: '', category: '輔具租借', icon: 'fa-bed', color: '#DD6B20', colorDark: '#C05621', needBinding: false },
            { id: 23, name: '助行器租借', desc: '各式助行器材租借', price: 'NT$ 300/週', originalPrice: '', category: '輔具租借', icon: 'fa-crutch', color: '#DD6B20', colorDark: '#C05621', needBinding: false },
            { id: 24, name: '氧氣機租借', desc: '居家氧氣設備租借', price: 'NT$ 3,000/月', originalPrice: '', category: '輔具租借', icon: 'fa-lungs', color: '#DD6B20', colorDark: '#C05621', needBinding: false }
        ];

        const searchInput = document.getElementById('serviceSearchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const sortFilter = document.getElementById('sortFilter');
        const searchResults = document.getElementById('searchResults');
        const emptyState = document.getElementById('emptyState');
        const resultCount = document.getElementById('resultCount');

        function getPriceValue(priceText) {
            const numberText = priceText.replace(/[^\d]/g, '');
            return numberText ? Number(numberText) : 0;
        }

        function renderResults(results) {
            resultCount.textContent = `(共 ${results.length} 項)`;

            if (results.length === 0) {
                searchResults.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            searchResults.innerHTML = results.map((service, index) => {
                const originalPrice = service.originalPrice
                    ? `<span class="original">${service.originalPrice}</span>`
                    : '';
                const bindingTag = service.needBinding ? '<span class="tag">需綁定機構</span>' : '';

                const imageIndex = (index % 4) + 1;
                const thumbnail = `<div class="service-image service-image-${imageIndex}"></div>`;

                return `
                    <div class="service-card" data-service-id="${service.id}" data-need-binding="${service.needBinding}">
                        ${thumbnail}
                        <div class="service-info">
                            <div>
                                <div class="service-name">${service.name}</div>
                                <div class="service-desc">${service.desc}</div>
                                <div class="institution-tags" style="margin-top: 8px;">
                                    <span class="tag">${service.category}</span>
                                    ${bindingTag}
                                </div>
                            </div>
                            <div class="service-price">
                                ${service.price}
                                ${originalPrice}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            searchResults.querySelectorAll('.service-card').forEach((card) => {
                const serviceId = card.dataset.serviceId;
                const needBinding = card.dataset.needBinding === 'true';

                card.addEventListener('click', () => {
                    if (needBinding) {
                        showToast('此服務需先綁定機構', 'warning');
                        return;
                    }

                    navigateTo(`service-detail.html?id=${serviceId}`);
                });
            });
        }

        function applyFilters() {
            const keyword = searchInput.value.trim().toLowerCase();
            const selectedCategory = categoryFilter.value;
            const sortMode = sortFilter.value;

            let results = allServices.filter((service) => {
                const searchText = `${service.name} ${service.desc} ${service.category}`.toLowerCase();
                const matchesKeyword = !keyword || searchText.includes(keyword);
                const matchesCategory = selectedCategory === 'all' || service.category === selectedCategory;
                return matchesKeyword && matchesCategory;
            });

            if (sortMode === 'price-asc') {
                results = [...results].sort((a, b) => getPriceValue(a.price) - getPriceValue(b.price));
            } else if (sortMode === 'price-desc') {
                results = [...results].sort((a, b) => getPriceValue(b.price) - getPriceValue(a.price));
            }

            renderResults(results);
        }

        function applyParams() {
            const params = new URLSearchParams(window.location.search);
            const keyword = params.get('q');
            const category = params.get('category');

            if (keyword) {
                searchInput.value = keyword;
            }

            if (category) {
                categoryFilter.value = category;
            }
        }

        searchInput.addEventListener('input', applyFilters);
        categoryFilter.addEventListener('change', applyFilters);
        sortFilter.addEventListener('change', applyFilters);

        applyParams();
        applyFilters();
        searchInput.focus();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>æ™ºæ…§ç…§è­·å¹³å° - ç‚ºæ‚¨æ¨è–¦</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- è‡ªè¨‚æ¨£å¼ -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        .main-content {
            padding-bottom: 100px;
        }

        /* â”€â”€â”€ è©•ä¼°æ‘˜è¦å¡ç‰‡ â”€â”€â”€ */
        .summary-card {
            margin: 16px;
            padding: 20px;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            border-radius: var(--radius-lg);
            color: #fff;
        }

        .summary-card .summary-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: var(--font-size-base);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .summary-card .summary-title i {
            font-size: 18px;
            opacity: 0.9;
        }

        .summary-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .summary-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 13px;
            backdrop-filter: blur(6px);
        }

        .summary-tag i {
            font-size: 11px;
        }

        /* â”€â”€â”€ æ¨è–¦æ¨™é¡Œ â”€â”€â”€ */
        .result-header {
            padding: 20px 16px 12px;
            text-align: center;
        }

        .result-header h2 {
            font-size: var(--font-size-xl);
            color: var(--text-primary);
            margin: 0 0 4px;
        }

        .result-header p {
            font-size: var(--font-size-sm);
            color: var(--text-light);
            margin: 0;
        }

        /* â”€â”€â”€ æ¨è–¦å•†å“å¡ç‰‡ â”€â”€â”€ */
        .recommend-list {
            padding: 0 16px;
        }

        .recommend-card {
            background: var(--card-background);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            margin-bottom: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .recommend-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .recommend-card-top {
            display: flex;
            align-items: stretch;
            position: relative;
        }

        /* æ’åæ¨™ç«  */
        .rank-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 800;
            color: #fff;
            z-index: 2;
        }

        .rank-badge.rank-1 {
            background: linear-gradient(145deg, #FFD700, #FFA500);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
        }

        .rank-badge.rank-2 {
            background: linear-gradient(145deg, #C0C0C0, #A0A0A0);
            box-shadow: 0 2px 8px rgba(192, 192, 192, 0.4);
        }

        .rank-badge.rank-3 {
            background: linear-gradient(145deg, #CD7F32, #A0522D);
            box-shadow: 0 2px 8px rgba(205, 127, 50, 0.4);
        }

        .recommend-icon-area {
            width: 100px;
            min-height: 110px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .recommend-icon-area i {
            font-size: 40px;
            color: #fff;
            opacity: 0.9;
        }

        .recommend-info {
            flex: 1;
            padding: 16px 16px 16px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
        }

        .recommend-name {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--text-primary);
        }

        .recommend-desc {
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .recommend-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 2px;
        }

        .match-tag {
            font-size: 11px;
            padding: 2px 8px;
            background: rgba(45, 106, 79, 0.08);
            color: var(--primary-color);
            border-radius: 10px;
            font-weight: 600;
        }

        /* åŒ¹é…åº¦ & åƒ¹æ ¼ */
        .recommend-card-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-top: 1px solid var(--divider-color);
            background: var(--background-color);
        }

        .match-score-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-ring {
            position: relative;
            width: 48px;
            height: 48px;
        }

        .match-ring svg {
            transform: rotate(-90deg);
            width: 48px;
            height: 48px;
        }

        .match-ring .ring-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 4;
        }

        .match-ring .ring-fill {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 4;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s ease;
        }

        .match-ring .ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 800;
            color: var(--primary-color);
        }

        .match-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .recommend-price {
            text-align: right;
        }

        .recommend-price .price-main {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--primary-color);
        }

        .recommend-price .price-sub {
            font-size: 12px;
            color: var(--text-light);
        }

        /* â”€â”€â”€ æŸ¥çœ‹è©³æƒ…æŒ‰éˆ• â”€â”€â”€ */
        .recommend-action {
            padding: 0 16px 16px;
        }

        .btn-detail {
            width: 100%;
            padding: 12px;
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            border: none;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .btn-detail:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
        }

        /* â”€â”€â”€ åº•éƒ¨æ“ä½œå€ â”€â”€â”€ */
        .bottom-actions {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--card-background);
            border-top: 1px solid var(--divider-color);
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            display: flex;
            gap: 10px;
            z-index: 100;
            box-sizing: border-box;
        }

        .btn-redo {
            flex: 1;
            padding: 14px 20px;
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .btn-redo:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-browse {
            flex: 1;
            padding: 14px 20px;
            background: linear-gradient(145deg, var(--accent-color), var(--accent-dark));
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            color: #fff;
            cursor: pointer;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(212, 165, 116, 0.3);
        }

        .btn-browse:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(212, 165, 116, 0.4);
        }

        /* â”€â”€â”€ ç©ºç‹€æ…‹ â”€â”€â”€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state i {
            font-size: 48px;
            color: var(--text-light);
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: var(--font-size-lg);
            color: var(--text-primary);
            margin: 0 0 8px;
        }

        .empty-state p {
            font-size: var(--font-size-sm);
            color: var(--text-light);
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- æ‰‹æ©Ÿå®¹å™¨ -->
    <div class="mobile-container">
        <!-- é ‚éƒ¨å°è¦½åˆ— -->
        <header class="header">
            <div class="header-left">
                <i class="fas fa-arrow-left" onclick="goBack()" style="cursor: pointer; margin-right: 12px;"></i>
                <div class="header-title">ç‚ºæ‚¨æ¨è–¦</div>
            </div>
            <div class="header-icons">
                <i class="fas fa-redo-alt" onclick="navigateTo('health-assessment.html')" style="cursor: pointer;" title="é‡æ–°è©•ä¼°"></i>
            </div>
        </header>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <main class="main-content">
            <!-- è©•ä¼°æ‘˜è¦ -->
            <div class="summary-card" id="summaryCard">
                <div class="summary-title">
                    <i class="fas fa-clipboard-check"></i>
                    <span>æ‚¨çš„å¥åº·é—œæ³¨</span>
                </div>
                <div class="summary-tags" id="summaryTags">
                    <!-- ç”± JS å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ¨è–¦æ¨™é¡Œ -->
            <div class="result-header">
                <h2><i class="fas fa-star" style="color: var(--accent-color);"></i> æœ€é©åˆæ‚¨çš„ä¿å¥æ–¹æ¡ˆ</h2>
                <p>æ ¹æ“šæ‚¨çš„å¥åº·è©•ä¼°çµæœï¼Œç‚ºæ‚¨ç²¾é¸ä»¥ä¸‹ä¿å¥é£Ÿå“</p>
            </div>

            <!-- æ¨è–¦å•†å“åˆ—è¡¨ -->
            <div class="recommend-list" id="recommendList">
                <!-- ç”± JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </main>

        <!-- åº•éƒ¨æ“ä½œå€ -->
        <div class="bottom-actions">
            <button class="btn-redo" onclick="navigateTo('health-assessment.html')">
                <i class="fas fa-redo-alt"></i> é‡æ–°è©•ä¼°
            </button>
            <button class="btn-browse" onclick="navigateTo('categories.html?category=ä¿å¥é£Ÿå“')">
                <i class="fas fa-th-large"></i> ç€è¦½å…¨éƒ¨
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadResults();
        });

        /**
         * è¼‰å…¥æ¨è–¦çµæœ
         */
        function loadResults() {
            const resultsRaw = localStorage.getItem('healthAssessmentResult');
            const answersRaw = localStorage.getItem('healthAssessmentAnswers');

            if (!resultsRaw) {
                showEmptyState();
                return;
            }

            const results = JSON.parse(resultsRaw);
            const answers = answersRaw ? JSON.parse(answersRaw) : {};

            // æ¸²æŸ“æ‘˜è¦æ¨™ç±¤
            renderSummary(answers);

            // æ¸²æŸ“æ¨è–¦å¡ç‰‡
            renderRecommendations(results);
        }

        /**
         * æ¸²æŸ“å¥åº·é—œæ³¨æ‘˜è¦
         */
        function renderSummary(answers) {
            const container = document.getElementById('summaryTags');
            if (!answers.goals || answers.goals.length === 0) {
                container.innerHTML = '<span class="summary-tag"><i class="fas fa-info-circle"></i> å°šæœªè¨­å®š</span>';
                return;
            }

            const iconMap = {
                'é—œç¯€ä¿é¤Š': 'fa-bone',
                'å¿ƒè¡€ç®¡ä¿å¥': 'fa-heart',
                'å…ç–«åŠ›æå‡': 'fa-shield-virus',
                'éª¨è³ªå¼·åŒ–': 'fa-dumbbell',
                'æ¶ˆåŒ–æ”¹å–„': 'fa-stomach',
                'é«”åŠ›å¢å¼·': 'fa-bolt',
                'ç¡çœ æ”¹å–„': 'fa-moon',
                'è¦–åŠ›ä¿å¥': 'fa-eye'
            };

            container.innerHTML = answers.goals.map(goal => {
                const icon = iconMap[goal] || 'fa-check';
                return `<span class="summary-tag"><i class="fas ${icon}"></i> ${goal}</span>`;
            }).join('');
        }

        /**
         * æ¸²æŸ“æ¨è–¦å•†å“å¡ç‰‡
         */
        function renderRecommendations(results) {
            const container = document.getElementById('recommendList');

            if (!results || results.length === 0) {
                showEmptyState();
                return;
            }

            const rankEmoji = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            const circumference = 2 * Math.PI * 18; // SVG åœ“åŠå¾‘ 18

            container.innerHTML = results.map((item, idx) => {
                const offset = circumference - (circumference * item.matchPercent / 100);
                return `
                    <div class="recommend-card" onclick="navigateTo('supplement-detail.html?id=${item.id}')">
                        <div class="recommend-card-top">
                            <div class="rank-badge rank-${idx + 1}">${rankEmoji[idx]}</div>
                            <div class="recommend-icon-area" style="background: linear-gradient(145deg, ${item.color}, ${item.colorDark});">
                                <i class="fas ${item.icon}"></i>
                            </div>
                            <div class="recommend-info">
                                <div class="recommend-name">${item.name}</div>
                                <div class="recommend-desc">${item.desc}</div>
                                ${item.matchedGoals && item.matchedGoals.length > 0 ? `
                                    <div class="recommend-tags">
                                        ${item.matchedGoals.map(g => `<span class="match-tag">${g}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="recommend-card-bottom">
                            <div class="match-score-wrap">
                                <div class="match-ring">
                                    <svg viewBox="0 0 40 40">
                                        <circle class="ring-bg" cx="20" cy="20" r="18"></circle>
                                        <circle class="ring-fill" cx="20" cy="20" r="18"
                                            stroke-dasharray="${circumference}"
                                            stroke-dashoffset="${offset}"
                                            style="stroke: ${item.color};"></circle>
                                    </svg>
                                    <span class="ring-text">${item.matchPercent}%</span>
                                </div>
                                <span class="match-label">é©åˆåº¦</span>
                            </div>
                            <div class="recommend-price">
                                <div class="price-main">NT$ ${item.subscriptionPrice.toLocaleString()}/æœˆ</div>
                                <div class="price-sub">å–®æ¬¡ NT$ ${item.singlePrice.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="recommend-action">
                            <button class="btn-detail" onclick="event.stopPropagation(); navigateTo('supplement-detail.html?id=${item.id}')">
                                <i class="fas fa-arrow-right"></i> æŸ¥çœ‹è©³æƒ…èˆ‡è³¼è²·æ–¹æ¡ˆ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * é¡¯ç¤ºç©ºç‹€æ…‹
         */
        function showEmptyState() {
            document.getElementById('summaryCard').style.display = 'none';
            document.getElementById('recommendList').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-clipboard-question"></i>
                    <h3>å°šæœªé€²è¡Œå¥åº·è©•ä¼°</h3>
                    <p>è«‹å…ˆå®Œæˆå•å·ï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨æ¨è–¦æœ€é©åˆçš„ä¿å¥é£Ÿå“</p>
                    <button class="btn-detail" onclick="navigateTo('health-assessment.html')" style="max-width: 220px; margin: 20px auto 0;">
                        <i class="fas fa-clipboard-check"></i> é–‹å§‹è©•ä¼°
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
